markdown:
  modules:
    latex:
      path: https://cdn.jsdelivr.net/npm/markdown-it-latex2img@0.0.6/dist/markdown-it-latex2img.js
    mermaid:
      loader: |
        <script> window.wait++;</script>
        <script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.4/dist/mermaid.esm.min.mjs';
          mermaid.initialize({
            startOnLoad: true
          });
          setTimeout(() => {window.wait--;}, 5000);
        </script>
  settings:
    html: true
    linkify: true
    typographer: true
    breaks: true

print:
  html: true
  pdf: true

pdf:
  format: 'A4'
  margin:
    top: "2 cm"
    bottom: "2 cm"
    left: "3 cm"
    right: "1.5 cm"
puppeteer:
  #  headless: false
  wait_timeout: 0

pages:
  header:
    index: 0
    pdf: "./PKSS_Header.pdf"
    docx: "./PKSS_Header.docx"


styles:
  - gost.css

replacements:
  - regex: <pre>\s*<code(?<prop>(?!.*class="language-mermaid").*?)>(?<code>[\w\W]*?)<\/code>\s*<\/pre>
    string: |
      <table class="code">
        <tr class="code">
          <td class="code">
            <pre><code$<prop>>$<code></code></pre>
          </td>
        </tr>
      </table>
  - regex: '<pre>\s*<code\s+class="language-mermaid">(?<info>---[\w\W]*?---\s*)?(?:%%\s*Title:\s*(?<title>.*?)\s*%%)?(?<code>[\w\W]*?)<\/code>\s*<\/pre>'
    string: |
      <div class="mermaid-container avoid-page-break centered">
        <div class="mermaid">$<info>$<code></div>
        <p class="figure-caption">$<title></p>
      </div>
